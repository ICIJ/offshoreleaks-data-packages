<style type="text/css" media="screen">
    @import url("https://offshoreleaks-data.icij.org/offshoreleaks/neo4j/guide/offshoreleaks_guide.css");
</style>
<article class="guide" ng-controller="AdLibDataController">
    <carousel class="deck container-fluid panama-deck">

        <slide class="row-fluid">
            <div class="row">
              <div class="col-sm-12">
                <img class="img-responsive img-thumbnail" src="https://guides.neo4j.com/sandbox/icij-panama-papers/img/panama-header.jpg">
              </div>
            </div>
            <div class="row">
              <div class="col-sm-12">
                <h3 style="text-align:center; margin-bottom: 1em;">The Data Connecting Politicians, Criminals and a Rogue Industry that hides their cash</h3>
              </div>
            </div>
          
            <div class="row">
          
              <div class="col-md-12 col-lg-6">
                <h4>Panama Papers: Secrets of the Global Elite</h4>
                <div class="embed-responsive embed-responsive-16by9">
                  <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/o4XeBz1hYJQ?rel=0" frameborder="0" allowfullscreen width="560" height="315"></iframe>
                </div>
              </div>
          
              <div class="col-md-12 col-lg-6">
                <h4>About this data</h4>
                <div class="panama-quote">
                  <p>The <a target="_blank" href="https://offshoreleaks.icij.org/">ICIJ Offshore Leaks database</a>, which you are working with in Neo4j, contains information on almost 785,000 offshore entities that are part of the Paradise and Panama Papers and the Offshore Leaks investigations. The data covers a long time of activities – and links to people and companies in more than 200 countries and territories.</p>
                  <p>The real value of the database is that it <strong>strips away the secrecy</strong> that cloaks companies and trusts incorporated in tax havens and exposes the people behind them. This includes, when available, the names of the real owners of those opaque structures. In all, it reveals more than 430,000 names of people and companies behind secret offshore structures. They come from leaked records and not a standardized corporate registry, so there may be duplicates. We suggest you confirm the identities of any individuals or entities located in the database based on addresses or other identifiable information.</p>
                  <p><strong>There are legitimate uses for offshore companies and trusts. We do not intend to suggest or imply that any persons, companies or other entities included in the database have broken the law or otherwise acted improperly. If you find an error in the database please get in touch with ICIJ.</strong></p>
                </div>
              </div>
            </div>
          
          </slide>
          
          <slide class="row-fluid">
          
            <div class="row">
              <div class="col-sm-12">
                <h3>The Shape of the Data</h3>
              </div>
            </div>
          
            <div class="row">
              <div class="col-md-6">
                <img class="img-responsive img-thumbnail" src="https://offshoreleaks-data.icij.org/offshoreleaks/neo4j/guide/img/datamodel.png" alt="data model">
              </div>
              <div class="col-md-6 col-sm-6">
                <div class="paragraph">
                  <p>The Offshore Leaks Database was imported into Neo4j to be used by journalists and researchers to take advantage of the connections in the data. To the left is the basic "property graph" data model. Each data record is called a "node" representing an entity, intermediary, officer or address. They're connected to form a "graph" that reveals a complex web of relationships. To the left you can see a simplified diagram how the nodes connect to each other.</p>
                </div>
          
                <div class="paragraph">
                  <p>These are the types of nodes that you will encounter in the data:</p>
                </div>
                <div class="ulist">
                  <ul>
                    <li>
                      <p><code>Entity</code> - The offshore legal entity. This could be a company, trust, foundation, or other legal entity created in a low-tax jurisdiction.</p>
                    </li>
                    <li>
                      <p><code>Officer</code> - A person or company who plays a role in an offshore entity, such as beneficiary, director, or shareholder. The relationships shown in the diagram are just a sample of all the existing ones.</p>
                    </li>
                    <li>
                      <p><code>Intermediary</code> - A go-between for someone seeking an offshore corporation and an offshore service provider — usually a law-firm or a middleman that asks an offshore service provider to create an offshore firm.</p>
                    </li>
                    <li>
                      <p><code>Address</code> - The registered address as it appears in the original databases obtained by ICIJ.</p>
                    </li>
                    <li>
                      <p><code>Other</code> - Other entities found in the data.</p>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </slide>
          
          
          <slide class="row-fluid">
            <div class="col-sm-12">
              <h3>How Graphs Helped our Investigation</h3>
              <div class="row-fluid">
                <div class="col-sm-12">
                  <div class="paragraph">
                    <p>The Offshore Leaks data exposes a set of connections between people and offshore entities.  Graph databases are the best way to explore the relationships between these people and entities&#8201;&#8212;&#8201;it&#8217;s much more intuitive to use for this purpose than a SQL database or other types of NoSQL databases.</p>
                </div>
              </div>
            </div>
              <div class="row-fluid">
                <div class="col-sm-5">
                  <div class="paragraph">
                    <p>For example, let's say we want to discover the shortest paths between two entity officers through a set of <code>Entity</code> or <code>Address</code> nodes.  This is quite easy with Cypher, Neo4j's graph query language.</p>
                  </div>
                  <pre mode="cypher"  class="highlight pre-scrollable code runnable standalone-example ng-binding"><code class="cypher language-cypher">MATCH (a:Officer),(b:Officer)
          WHERE a.name CONTAINS 'Smith' 
            AND b.name CONTAINS 'Grant'
          MATCH p=allShortestPaths((a)-[:officer_of|:intermediary_of|:registered_address*..10]-(b))
          RETURN p
          LIMIT 50</code></pre>
          
                  <div class="paragraph">
                    <p>To execute this query, please <strong>click</strong> on the statement above to put the query in the query editor above. <br/>Hit the triangular <span class="icon"><i class="fa fa-play-circle"></i></span> button or press <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>Enter</kbd></span> to <strong>run it</strong> and see the resulting visualization.</p>
                  </div>
                </div>
                <div class="col-sm-7">
                  <p>The resulting graph allows us to explore how these people are connected:</p>
                  <img class="img-responsive img-thumbnail" src="https://offshoreleaks-data.icij.org/offshoreleaks/neo4j/guide/img/shortestPaths.png">
                </div>
              </div>
            </div>
          </div>
          
          </slide>
          
          <slide class="row-fluid">
          
            <div class="row">
              <div class="col-sm-12">
                <h3>How to ask questions using a query language</h3>
          
          
          
                <h4>Graph Patterns</h4>
                <div class="paragraph">
                  <p>Neo4j’s query language, Cypher, is centered around <strong>graph patterns</strong> which represents entities with parentheses, for example, 
                <code>(e:Entity)</code> and connections with arrows, for example <code>-[:intermediary_of]-&gt;</code>.
                  <code>:Entity</code> and <code>:intermediary_of</code> are the types of the entity and the connection, respectively.
                </div>
                <div class="paragraph">
                  <p>Here is an example pattern: <code>(:Intermediary)-[:intermediary_of]-&gt;(:Entity)</code>.
                  These patterns may be found with the <code>MATCH</code> clause.</p>
                </div>
          
          
          
                <h4>Other Clauses</h4>
                <div class="paragraph">
                  <p>The following clauses may follow a <code>MATCH</code> clause.
                    They work with the properties stored at the nodes and relationships found in the graph matching that pattern.</p>
                </div>
                <table class="tableblock frame-all grid-all spread">
                <colgroup>
                <col style="width: 15%;">
                <col style="width: 85%;">
                </colgroup>
                <tbody>
                <tr>
                <td class="tableblock halign-left valign-top"><p class="tableblock">filter</p></td>
                <td class="tableblock halign-left valign-top"><p class="tableblock"><code>WHERE intermediary.name CONTAINS 'MOSSACK'</code></p></td>
                </tr>
                <tr>
                <td class="tableblock halign-left valign-top"><p class="tableblock">aggregate</p></td>
                <td class="tableblock halign-left valign-top"><p class="tableblock"><code>WITH e.jurisdiction AS country, COUNT(*) AS frequency</code></p></td>
                </tr>
                <tr>
                <td class="tableblock halign-left valign-top"><p class="tableblock">return</p></td>
                <td class="tableblock halign-left valign-top"><p class="tableblock"><code>RETURN country, frequency</code></p></td>
                </tr>
                <tr>
                <td class="tableblock halign-left valign-top"><p class="tableblock">order</p></td>
                <td class="tableblock halign-left valign-top"><p class="tableblock"><code>ORDER BY frequency DESC</code></p></td>
                </tr>
                <tr>
                <td class="tableblock halign-left valign-top"><p class="tableblock">limit</p></td>
                <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIMIT 20;</code></p></td>
                </tr>
                </tbody>
                </table>
                <div class="listingblock">
                <div class="title">Jurisdiction distribution of intermediaries in the ICIJ offshore leaks DB</div>
                <div class="content">
                <pre mode="cypher"  class="highlight pre-scrollable code runnable standalone-example ng-binding"><code class="cypher language-cypher">MATCH (intermediary:Intermediary)-[:intermediary_of]-&gt;(e:Entity)
          WHERE intermediary.name CONTAINS 'MOSSFON'
          RETURN e.jurisdiction AS country, COUNT(*) AS frequency
          ORDER BY frequency DESC LIMIT 20;</code></pre>
                </div>
                </div>
                <div class="paragraph">
                <p>Click on the block to put the query in the topmost window on the query editor. Hit the triangular <span class="icon"><i class="fa fa-play-circle"></i></span> button or press <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>Enter</kbd></span> to run it and see the resulting visualization.</p>
                </div>
              </div>
            </div>
          
          </slide>

        <slide class="row-fluid">
            <div class="row">
                <div class="col-sm-12">
                    <h3>Querying the Data</h3>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 visible-sm visible-xs">
                    <img class="img-responsive img-thumbnail"
                         src="https://offshoreleaks-data.icij.org/offshoreleaks/neo4j/guide/img/datamodel_med.png"
                         alt="investigating">
                </div>
                <div class="col-lg-6">
                    <div class="paragraph">
                        <p>This guide covers:</p>
                    </div>
                    <div class="ulist">
                        <ul>
                            <li>
                                <p>Statistics</p>
                            </li>
                            <li>
                                <p>Visual vs Tabular Results</p>
                            </li>
                            <li>
                                <p>Investigating invidual people and entities</p>
                            </li>
                            <li>
                                <p>Finding x-degree relationships</p>
                            </li>
                            <li>
                                <p>Finding shortest paths and connections between entities</p>
                            </li>
                            <li>
                                <p>Frequently recurring pairs</p>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="paragraph">
                        <p>This interactive guide will help you explore the Paradise and Panama Papers and the Offshore
                            Leaks data using Cypher, Neo4j&#8217;s graph query language.</p>
                    </div>
                    <div class="paragraph">
                        <p>You&#8217;ll have the same investigative power we had in order to discover additional stories
                            behind the data.</p>
                    </div>
                    <div class="paragraph">
                        <p>Be sure to check out the <a
                                play-topic="https://offshoreleaks-data.icij.org/offshoreleaks/neo4j/guide/datashape.html">shape
                            of the data section</a> to understand the basics of Cypher and the data model used in the
                            graph database.</p>
                    </div>
                </div>
            </div>
        </slide>


        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Overview</h3>
                <br/>
                <div>


                    <h4>Let’s see what data is in this database.</h4>
                    <div class="paragraph">
                        <p>Run the embedded query to examine graph structure that we have just created.
                            We see nodes for each type of entity, connected by the relationships they have.</p>
                    </div>
                    <div class="listingblock">
                        <h4>Meta Graph</h4>
                        <div class="content">
                            <div class="row">
                                <div class="col-lg-6">
                                    <pre mode="cypher"
                                         class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
                                            class="cypher language-cypher">CALL db.schema()</code></pre>
                                </div>
                                <div class="col-lg-6">
                                    <div class="paragraph">
                                        <p>To execute this query, please <strong>click</strong> on the statement above
                                            to put the query in the query editor above. <br/>Hit the triangular <span
                                                    class="icon"><i class="fa fa-play-circle"></i></span> button or
                                            press <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>Enter</kbd></span> to
                                            <strong>run it</strong> and see the resulting visualization.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="listingblock">
                                <h4>Counts per entity type</h4>
                                <div class="row">
                                    <div class="col-lg-6">
    <pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
            class="cypher language-cypher">MATCH (node)
RETURN labels(node) AS type,count(*)</code></pre>
                                    </div>
                                    <div class="col-lg-6">
                                        <p>We can also check how many entities of each type are in our database.</p>
                                    </div>
                                </div>
                            </div>

                            <h4>Which intermediaries have the most connections to which entities</h4>
                            <div class="listingblock">
                                <div class="content">
    <pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
            class="cypher language-cypher">MATCH (i:Intermediary) WHERE size( (i)--() ) &gt; 100
MATCH (i)-[connection]-(entity)
RETURN i.name as intermediary, type(connection) as relationship, head(labels(entity)) as type, count(*) as count
ORDER BY count DESC LIMIT 20</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4>Filter datasource</h4>
                    <div class="paragraph">
                        <p>Note that the above query is searching the Offshore leaks, Paradise- and Panama Papers
                            datasets. To filter for just one source, use a <code>WHERE</code> clause. For example:
                    </div>
                    <div class="listingblock">
                        <div class="content">
    <pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
            class="cypher language-cypher">MATCH (i:Intermediary) WHERE i.sourceID = "Panama Papers" AND size( (i)--() ) &gt; 100
MATCH (i)-[connection]-(entity)
RETURN i.name as intermediary, type(connection) as relationship, head(labels(entity)) as type, count(*) as count
ORDER BY count DESC LIMIT 20</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </slide>

        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Query for visual results</h3>
                <div>
                    <div class="paragraph">
                        <p>Querying the graph with Cypher is all about graph pattern matching. To query the graph we
                            define graph patterns to be searched. For example, we can define the pattern "Intermediary
                            connected to an <code>Entity</code> node through the <code>intermediary_of</code> relationship" as:</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
                            <pre><code>(i:Intermediary)-[r:intermediary_of]-&gt;(e:Entity)</code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>We use variables <code>i</code>, <code>e</code> and <code>r</code> respectively for later
                            filtering with <code>WHERE</code> and <code>RETURN</code>ing results, these are aliases that
                            can be reused within a single Cypher statement.</p>
                    </div>
                </div>
            </div>

            <div class="listingblock col-sm-12">
                <h4>Entities registered by an Intermediary</h4>
                <div class="content">
                    <div class="row">
                        <div class="col-lg-6">
    <pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
            class="cypher language-cypher">MATCH (i:Intermediary)-[r:intermediary_of]-&gt;(e:Entity)
WHERE i.name CONTAINS "MOSSACK"
RETURN i, r, e LIMIT 100</code></pre>
                        </div>
                        <div class="col-lg-6">
                            <p>The results of this query are visualized as a graph, you can switch between the graph
                                visualization and tabular results with the icons on the left side of the results
                                view.</p>
                        </div>
                    </div>
                </div>
            </div>
        </slide>

        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Query for tabular results</h3>
                <br/>
                <div>
                    <div class="paragraph">
                        <p>Let's query for the pattern "Officer node connected to an <code>Entity</code> node through <code>connected_to</code> relationship:</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
                            <pre><code>(o:Officer)-[:connected_to]-&gt;(:Entity)</code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>We then <code>count</code> the entities per officer in an <strong>aggregation</strong> and
                            <code>ORDER BY</code> that count <code>DESC</code>ending and return the top-10 results.</p>
                    </div>
                    <div class="listingblock">
                        <h4>Officers with most entities</h4>
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">MATCH (o:Officer)-[:BENEFICIARY_OF]-&gt;(:Entity)
RETURN o.name, count(*) as entities
ORDER BY entities DESC LIMIT 10</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </slide>


        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Search for Officer nodes by name</h3>
                <br/>
                <div>
                    <div class="paragraph">
                        <p>Enter any name (e.g. from our <a target="_blank" href="https://www.icij.org/investigations/">published investigations</a>) into the form then click on the query to execute to see if that person appears
                            in the data. Note that this search is case sensitive and searches exact matches only.
                            We're setting a parameter for the officer which we can reuse later, just click and run the <code>:param</code> block.</p>
                    </div>
                    <form>
                        <div class="node">
                            <div class="form-group">
                                <label>Name of officer:</label> <input value-for="officer" class="form-control"
                                                                       value="A Name">
                            </div>
                        </div>
                    </form>
                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">:param officer:"<span value-key="officer">A Name</span>"</code></pre>
                        </div>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">MATCH (o:Officer)
WHERE o.name CONTAINS $officer
RETURN o
LIMIT 100</code></pre>
                        </div>
                    </div>

                    <div class="paragraph">
                        After running the query, <strong>you can double-click on any node to expand connections</strong> in the graph around that node.
                    </div>
                </div>
            </div>
        </slide>


        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Search for an Officer and find the connections</h3>
                <br/>
                <div class="paragraph">
                    <p>Let’s see with which entities our officer was involved with, including first and second degree connections.</p>
                </div>
                <div class="listingblock">
                    <h4>1st degree</h4>
                    <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">MATCH (o:Officer)
WHERE o.name CONTAINS $officer
MATCH path = (o)-[r]->(:Entity)
RETURN path LIMIT 100</code></pre>
                    </div>
                </div>
                <div class="listingblock">
                    <h4>2nd degree entities</h4>
                    <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">MATCH (o:Officer) WHERE o.name CONTAINS $officer
MATCH path = (o)-[]->(:Entity)
      <-[]-(:Officer)-[]->(:Entity)
RETURN path LIMIT 100</code></pre>
                    </div>
                </div>
            </div>


        </slide>

        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Find who is behind an Entity and the roles that they play</h3>
                <br/>
                <div>

                    <form>
                        <div class="node">
                            <div class="form-group">
                                <label>Name of entity:</label> <input value-for="entity" class="form-control" value="An Entity">
                            </div>
                        </div>
                    </form>
                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding">
<code class="cypher language-cypher">:param entity:"<span value-key="entity">An Entity</span>"</code></pre>
                        </div>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">MATCH (e:Entity)-[r]-(o:Officer)
WHERE e.name CONTAINS $entity
RETURN *
LIMIT 100</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </slide>


        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Joint involvement</h3>
                <br/>
                <div>
                    <div class="paragraph">
                        <p>When investigating, it is very important to identify people that appear to operate together.
                            You can try to find if two officers appear connected to the same entities recurrently by
                            using this query. Note that in this case, the first results show companies because companies
                            can also be officers of entities.</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">MATCH (o1:Officer)-[r1]-&gt;(e:Entity)&lt;-[r2]-(o2:Officer)
USING JOIN ON e
WHERE id(o1) &lt; id(o2) AND size( (o1)--&gt;() ) &gt; 10 AND size( (o2)--&gt;() ) &gt; 10
WITH o1,o2,count(*) as freq, collect(e)[0..10] as entities
WHERE freq &gt; 10
WITH * ORDER BY freq DESC LIMIT 10
RETURN o1.name, o2.name, freq, [e IN entities | e.name]
</code></pre>
                        </div>
                    </div>

                    <div class="paragraph">
                        <p>We can attempt to remove companies from the results by filtering our Officer names that
                            contain strings commonly found in company names such as "LLC", "Limited", "Ltd", etc:</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">MATCH (o1:Officer)-[r1]-&gt;(e:Entity)&lt;-[r2]-(o2:Officer)
USING JOIN ON e
WHERE id(o1) &lt; id(o2) AND NOT o1.name CONTAINS "LIMITED" AND NOT o1.name CONTAINS "Limited"
AND NOT o2.name CONTAINS "Limited" AND NOT o2.name CONTAINS "LIMITED"
AND size( (o1)--&gt;() ) &gt; 10 AND size( (o2)--&gt;() ) &gt; 10
WITH o1,o2,count(*) as freq, collect(e)[0..10] as entities
WHERE freq &gt; 10
WITH * ORDER BY freq DESC LIMIT 10
RETURN o1.name, o2.name, freq, [e IN entities | e.name]
</code></pre>
                        </div>

                    </div>
                    <div class="paragraph">
                        <p>Lets visualize this graph with virtual relationships</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">MATCH (o1:Officer)-[r1]-&gt;(e:Entity)&lt;-[r2]-(o2:Officer)
USING JOIN ON e
WHERE id(o1) &lt; id(o2) AND NOT o1.name CONTAINS "LIMITED" AND NOT o1.name CONTAINS "Limited"
AND NOT o2.name CONTAINS "Limited" AND NOT o2.name CONTAINS "LIMITED"
AND size( (o1)--&gt;() ) &gt; 10 AND size( (o2)--&gt;() ) &gt; 10
WITH o1,o2,count(*) as freq, collect(e)[0..10] as entities
WHERE freq &gt; 200
RETURN o1,o2,apoc.create.vRelationship(o1,'JOINT',{freq:freq,entities:[e IN entities| e.name]},o2)
</code></pre>
                        </div>

                    </div>
                </div>
            </div>
        </slide>


        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Shortest path between two people</h3>
                <br/>
                <div>
                    <form>
                        <div class="node">
                            <div class="form-group">
                                <label>Name of the first officer:</label> <input value-for="officerOne" value="Xian"
                                                                                 class="form-control">
                                <label>Name of the second officer:</label> <input value-for="officerTwo" value="Grant"
                                                                                  class="form-control">
                            </div>
                        </div>
                    </form>
                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">MATCH (a:Officer),(b:Officer)
WHERE a.name CONTAINS '<span value-key="officerOne">Smith</span>' AND b.name CONTAINS '<span value-key="officerTwo">Grant</span>'
WITH a,b LIMIT 20000
MATCH p=allShortestPaths((a)-[:officer_of|:intermediary_of|:registered_address*..10]-(b))
RETURN p
LIMIT 50</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </slide>

        <!-- LOCATION QUERIES -->

        <!-- ADDRESS QUERY -->
        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Query by address</h3>
                <br/>
                <div>
                    <div class="paragraph">
                        <p>We can use Neo4j's string comparison functions to search for addresses that contain cities
                            and countries in which we are interested: </p>
                    </div>
                    <form>
                        <div class="node">
                            <div class="form-group">
                                <label>City: </label> <input value-for="city" value="Barcelona" class="form-control">
                                <label>State/Country: </label> <input value-for="state" value="Spain"
                                                                      class="form-control">
                            </div>
                        </div>
                    </form>
                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">MATCH (a:Address)<-[:registered_address]-(other)
WHERE a.address CONTAINS '<span value-key="city">Barcelona</span>' AND a.address CONTAINS '<span
            value-key="state">Spain</span>'
RETURN a, other
LIMIT 100</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </slide>

        <!-- OFFSHORE ENTITY JURISDICTIONS BY INTERMEDIARY QUERY -->
        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Offshore entity juridictions by intermediary</h3>
                <br/>
                <div>
                    <div class="paragraph">
                        <p>What are the most popular offshore jurisdictions for certain intermediaries?</p>
                    </div>
                    <form>
                        <div class="node">
                            <div class="form-group">
                                <label>Name of the intermediary:</label> <input value-for="intermediary" value="MOSSACK"
                                                                                class="form-control">
                            </div>
                        </div>
                    </form>
                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">MATCH (i:Intermediary)-[:intermediary_of]->(e:Entity)
WHERE i.name CONTAINS '<span value-key="intermediary">MOSSACK</span>'
RETURN e.jurisdiction_description AS jurisdiction, count(*) AS number
ORDER BY number DESC LIMIT 10</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </slide>


        <!-- MOST POPULAR OFFSHORE JURISDICTIONS FOR PEOPLE CONNECTED TO THE US -->
        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Most popular offshore jurisdiction for people connected to a country</h3>
                <br/>
                <div>
                    <div class="paragraph">
                        <p>What are the common offshore jurisdictions for officers with addresses in a certain
                            country?</p>
                    </div>
                    <form>
                        <div class="node">
                            <div class="form-group">
                                <label>Country code:</label> <input value-for="countryCode" value="USA"
                                                                    class="form-control">
                            </div>
                        </div>
                    </form>
                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">MATCH (o:Officer)-->(e:Entity)<-[:intermediary_of]-(i:Intermediary)
WHERE o.country_codes CONTAINS '<span value-key="countryCode">USA</span>' and i.sourceID = 'Panama Papers'
RETURN e.jurisdiction_description AS jurisdiction, count(*) AS number
ORDER BY number DESC LIMIT 10</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </slide>


        <!-- MOST POPULAR OFFSHORE JURISDICTIONS FOR PEOPLE WITH ADDRESSES IN ____ CITY -->
        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Most popular offshore jurisdictions for people with addresses in a certain city</h3>
                <br/>
                <div>
                    <div class="paragraph">
                        <p>What are the common offshore jurisdictions used by people connected to certain cities?</p>
                    </div>
                    <form>
                        <div class="node">
                            <div class="form-group">
                                <label>City:</label> <input value-for="state" value="London" class="form-control">
                                <label>State/country:</label> <input value-for="state" value="United Kingdom" class="form-control">
                            </div>
                        </div>
                    </form>
                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">MATCH (a:Address)<-[:registered_address]-(o:Officer),
(o)-->(e:Entity)<-[:intermediary_of]-(i:Intermediary)
WHERE a.address CONTAINS '<span valeue-key="city">London</span>' AND a.address CONTAINS '<span value-key="state">United Kingdom</span>'
RETURN e.jurisdiction_description AS jurisdiction, count(*) AS number 
ORDER BY number DESC LIMIT 10</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </slide>


        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Most popular intermediaries for people with an address in a certain city?</h3>
                <br/>
                <div>
                    <div class="paragraph">
                        <p>Who are the most common intermediaries for officers connected to addresses in certain
                            places?</p>
                    </div>
                    <form>
                        <div class="node">
                            <div class="form-group">
                                <label>State/country:</label> <input value-for="state" value="Isle of Man"
                                                                     class="form-control">
                            </div>
                        </div>
                    </form>
                    <div class="listingblock">
                        <div class="content">
          <pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
                  class="cypher language-cypher">MATCH (a:Address)<-[:registered_address]-(o:Officer),
(o)-->(e:Entity)<-[:intermediary_of]-(i:Intermediary)
WHERE a.address CONTAINS '<span value-key="state">Isle of Man</span>'
RETURN i.name AS intermediary, count(DISTINCT e) AS number 
ORDER BY number DESC LIMIT 10</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </slide>


        <!-- END LOCATION QUERIES -->


        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Full Text Search</h3>
                <br/>
                <div>
                    <div class="paragraph">
                        <p>All the previous queries we run were searching the exact text of a node. However, you can
                            also build an index to search the text of properties inside a node. Just like in a book
                            where you look at the index to find a section that interest you, and then start reading from
                            there.</p>

                        <p>For that, you need to build the index first. It will take a little while since the procedure
                            has to read through the entire database to create it.</p>
                    </div>

                    <div class="paragraph">
                        <p><em>We used Solr as a full text search engine to search across all data.
                            But you can do the same in Neo4j directly, both use Apache Lucene under the hood for full
                            text search.</em></p>
                    </div>

                    <div class="paragraph">
                        <p>In order to use the full text search feature, we indexed our data by specifying
                            all the properties we want to index.
                            Here we create a full text index called <code>offshore</code> (we will use this name when
                            searching in the index) with our data.
                            <strong>You don't have to run this, it's just here as an example</strong>
                        </p>
                    </div>

                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">CALL apoc.index.addAllNodes('offshore',{
  Officer: ["name","countries"],
  Intermediary:  ["name","address","countries"],
  Address: ["address","countries"],
  Entity: ["name", "address", "service_provider", "former_name", "company_type","countries"]})</code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>We can now use this index to search for any text contained in the properties. As a result of
                            the query you'll get the nodes with matching text.</p>
                    </div>

                    <div class="paragraph">
                        <p>The most simple case would be to search across all data for an exact match of a particular
                            word.</p>
                    </div>

                    <div class="paragraph">
                        <p>If you enter a word into the form, all occurrences will be found (but limited to 100
                            results).</p>
                    </div>

                    <form>
                        <div class="node">
                            <div class="form-group">
                                <label>Word to search for:</label> <input value-for="search" class="form-control" value="Nike">
                            </div>
                        </div>
                    </form>
                    <div class="listingblock">
                        <div class="content">
                            <pre mode="cypher"
                                 class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
                                    class="cypher language-cypher">CALL apoc.index.search("offshore", '<span
                                    value-key="search">Nike</span>')</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </slide>


        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Full text search - advanced</h3>
                <br/>
                <div>
                    <div class="paragraph">
                        <p>You can futher restrict the full text search to only searching in a particular property. In
                            order to seach for an <code>Entity</code> incorporated by offshore service provider <em>Mossack
                                Fonseca</em>, use the following: </p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
                            <pre mode="cypher"
                                 class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
                                    class="cypher language-cypher">CALL apoc.index.search("offshore", "Entity.service_provider:Mossack Fonseca")</code></pre>
                        </div>
                    </div>
                    <h4>Test it yourself:</h4>
                    <form>
                        <div class="node">
                            <div class="form-group">
                                <label>Label/Type to search for:</label> <input value-for="label" value="Entity"
                                                                                class="form-control">
                                <label>Attribute to search for:</label> <input value-for="property"
                                                                               value="service_provider"
                                                                               class="form-control">
                                <label>Word to search for:</label> <input value-for="search" value="Mossack Fonseca"
                                                                          class="form-control">
                            </div>
                        </div>
                    </form>
                    <div class="listingblock">
                        <div class="content">
                            <pre mode="cypher"
                                 class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
                                    class="cypher language-cypher">CALL apoc.index.search("offshore", "<span
                                    value-key="label">Entity</span>.<span
                                    value-key="property">service_provider</span>:<span value-key="search">Mossack Fonseca</span>")</code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Now we can search for nodes with a specific property value, and then
                            <strong>explore their neighbourhoods visually by double-clicking</strong> to expand relationships.</p>
                    </div>
                </div>
            </div>
        </slide>


        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Full text search with graph patterns</h3>
                <br/>
                <div>
                    <div class="paragraph">
                        <p>Previously we searched for nodes by matching against property values. However, integrating
                            text search with an graph query is so much more powerful.</p>
                        <p>We could for instance search for addresses in the database that contain the word "New York",
                            and then find all entities registered at those addresses:</p>
                    </div>

                    <div class="listingblock">
                        <div class="content">
    <pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
            class="cypher language-cypher">CALL apoc.index.search("offshore", 'Address.address:"New York"')
YIELD node AS addr
MATCH (addr)&lt;-[:registered_address]-(entity)
RETURN addr, entity LIMIT 50</code></pre>
                        </div>
                    </div>


                    <div class="paragraph">
                        <p>There may be typos in the data so we can use fuzzy matching to find addresses that have
                            inconsistent spellings.</p>
                        <p>Add a tilde (~) to instruct the index search procedure to do a fuzzy match, allowing you to
                            find “Malta” even if the spelling is slightly off.</p>
                    </div>

                    <div class="listingblock">
                        <div class="content">
    <pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
            class="cypher language-cypher">CALL apoc.index.search("offshore", "Address.address:Malta~")
YIELD node AS addr
MATCH (addr)&lt;-[:registered_address]-(entity)
RETURN addr, entity LIMIT 50</code></pre>
                        </div>
                    </div>


                    <div class="paragraph">
                        <p>You might notice that there are addresses that contain the word “Barcelona” that are not in
                            Barcelona, Spain.</p>

                        <p>We can further specify that we want the text to contain both the word Barcelona, and the word
                            Spain:</p>
                    </div>

                    <div class="listingblock">
                        <div class="content">
    <pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
            class="cypher language-cypher">CALL apoc.index.search("offshore", "+Address.address:Barcelona~ +Spain~")
YIELD node AS addr
MATCH (addr)&lt;-[:registered_address]-(entity)
RETURN addr, entity LIMIT 50</code></pre>
                        </div>
                    </div>

                    <div class="paragraph">
                        <p>For more details on the query syntax used in the second parameter of the <code>search</code>
                            procedure, please see <a target="_blank" href="https://www.lucenetutorial.com/lucene-query-syntax.html">this
                                Lucene query tutorial</a></p>
                    </div>

                </div>
            </div>
        </slide>


        <slide class="row-fluid">
            <div class="col-sm-12">
                <h3>Graph Analytics</h3>
                <br/>
                <div>
                    <div class="paragraph">
                        <p>PageRank is an algorithm used for instance by Google to rank websites in their search engine
                            results.
                            It assumes that more important entities are likely to have more connections pointing to
                            them, and not just directly but also indirectly.</p>
                    </div>
                    <div class="paragraph">
                        <p>The algorithm can also be used as way of measuring the importance of entities in a network.
                            Let’s use PageRank to find the top 20 ranked entities in the dataset.</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">CALL algo.pageRank.stream() YIELD node, score
WHERE node:Entity
RETURN node.name AS entity, score
ORDER BY score DESC
LIMIT 20</code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Now let’s try a similar query but investigating different patterns.
                            The following detects the 10 top ranked addresses.
                            It then finds how many entities are registered at those addresses. Note that the address
                            nodes contain text that has not been standardized, therefore there may be inconsistencies in
                            the address data.</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre mode="cypher" class="highlight pre-scrollable code runnable standalone-example ng-binding"><code
        class="cypher language-cypher">CALL algo.pageRank.stream() YIELD node as address, score
WHERE address:Address
WITH * ORDER BY score DESC  LIMIT 10
MATCH (address)&lt;-[:registered_address]-(e:Entity)
RETURN address.address, count(e) AS count
ORDER BY count DESC</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </slide>


        <slide class="row-fluid">
            <div class="col-sm-12">
              <h3>Explore the Pandora, Panama, and Paradise Papers Yourself</h3>
                
              </div>
              <div class="row">
                <style type="text/css">
                .boxes i { 
                  display: none;
                }
                .boxes .teaser-4 {
                  width: 18%;
                }
                .boxes .teaser-4 .icon-holder .topic-bullets {
                  margin-left: 5px;
                }
                </style>
                <div class="col-lg-12 boxes">
          
                  <div class="teaser teaser-4">
                    <h3>Shape of the Data</h3>
                    <p class="lead">Understand the data model.</p>
                    <div class="icon-holder">
                      <div class="icon sl sl-network green icon"></div>
                      <ul class="topic-bullets">
                        <li>What are the nodes?</li>
                        <li>What are the relationships?</li>
                        <li>What are the properties?</li>
                      </ul>
                      <div class="clearfix"></div>
                    </div>
                    <a play-topic="https://guides.neo4j.com/sandbox/icij-offshoreleaks/datashape.html"><button click-to-code="':play https://guides.neo4j.com/sandbox/icij-offshoreleaks/datashape.html'" class="btn btn-cta" style="background: #B3490E;padding:1em;color:#fff;">The Data Model</button></a>
                  </div>
          
                  <div class="teaser teaser-4">
                    <h3>Pandora Papers</h3>
                    <p class="lead">Explore the latest leak yourself.</p>
                    <div class="icon-holder">
                      <div class="icon sl sl-show yellow icon"></div>
                      <ul class="topic-bullets">
                        <li>Cypher query intro</li>
                        <li>Finding companies and individuals</li>
                        <li>Power Players</li>
                      </ul>
                      <div class="clearfix"></div>
                    </div>
                    <a play-topic="https://guides.neo4j.com/sandbox/icij-offshoreleaks/pandora-papers-examples.html"><button click-to-code="':play https://guides.neo4j.com/sandbox/icij-offshoreleaks/pandora-papers-examples.html'" class="btn btn-cta" style="background: #B3490E;padding:1em;color:#fff;">Pandora Papers Queries</button></a>
                  </div>
          
                  <div class="teaser teaser-4">
                    <h3>Paradise Papers</h3>
                    <p class="lead">Explore the Appleby data yourself.</p>
                    <div class="icon-holder">
                      <div class="icon sl sl-show yellow icon"></div>
                      <ul class="topic-bullets">
                        <li>Cypher query intro</li>
                        <li>Finding companies and individuals</li>
                        <li>Path finding</li>
                      </ul>
                      <div class="clearfix"></div>
                    </div>
                    <a play-topic="https://guides.neo4j.com/sandbox/icij-offshoreleaks/paradise-papers-examples.html"><button click-to-code="':play https://guides.neo4j.com/sandbox/icij-offshoreleaks/paradise-papers-examples.html'" class="btn btn-cta" style="background: #B3490E;padding:1em;color:#fff;">Paradise Papers Queries</button></a>
                  </div>
          
                  <div class="teaser teaser-4">
                    <h3>Panama Papers</h3>
                    <p class="lead">Explore the Mossack Fonseca data yourself.</p>
                    <div class="icon-holder">
                      <div class="icon sl sl-show yellow icon"></div>
                      <ul class="topic-bullets">
                        <li>Cypher query intro</li>
                        <li>Explore the Panama Law Firm files</li>
                        <li>Connect the dots</li>
                      </ul>
                      <div class="clearfix"></div>
                    </div>
                    <a play-topic="https://guides.neo4j.com/sandbox/icij-offshoreleaks/panama-papers-examples.html"><button click-to-code="':play https://guides.neo4j.com/sandbox/icij-offshoreleaks/panama-papers-examples.html'" class="btn btn-cta" style="background: #B3490E;padding:1em;color:#fff;">Panama Papers Queries</button></a>
                  </div>
          
          
                  <div class="teaser teaser-4">
                    <h3>Send ICIJ a tip</h3>
                    <p class="lead">Help us investigate.</p>
                    <div class="icon-holder">
                      <div class="icon sl sl-pencil red icon"></div>
                      <ul class="topic-bullets">
                        <li>Interesting connections</li>
                        <li>Entities that matter to you</li>
                      </ul>
                      <div class="clearfix"></div>
                    </div>
                    <a target="_blank" target="_blank" href="https://offshoreleaks.icij.org/tips/new" class="btn" id="b"><button class="btn btn-cta" style="background: #1da1f2;padding:1em; color:#fff;">Send tip</button></a>
                  </div>
                </div>
              </div>
          
              <div class="row">
                <div class="col-lg-12">
                  <div>
                    <h3 style="padding:10px;">Further Resources</h3>
                    <div class="ulist">
                      <ul>
                        <li>
                          <p><a target="_blank" href="https://www.icij.org/investigations/pandora-papers/">The Pandora Papers ICIJ Site</a></p>
                        </li>
                        <li>
                          <p><a target="_blank" href="https://www.icij.org/investigations/paradise-papers/">The Paradise Papers ICIJ Site</a></p>
                        </li>
                        <li>
                          <p><a target="_blank" href="https://www.icij.org/investigations/panama-papers/">The Panama Papers ICIJ Site</a></p>
                        </li>
                        <li>
                          <p><a target="_blank" href="https://offshoreleaks.icij.org/">The Offshore Leaks Database</a></p>
                        </li>
                        <li>
                          <p><a target="_blank" href="https://neo4j.com/docs/cypher-refcard/current/">Cypher Reference Card</a></p>
                        </li>
                        <li>
                          <p><a target="_blank" href="https://neo4j.com/developer">Neo4j Developer Documentation</a></p>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
          
            </div>
          </slide>
            </carousel>


</article>
